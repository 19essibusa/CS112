/* PlayListTester.cpp defines the PlayList test-methods.
 * Student Name: Einstein Essibu
 * Date:02/13/20
 * Begun by: Joel Adams, for CS 112 at Calvin University.
 */

#include "PlayListTester.h"
#include <iostream>
using namespace std;
#include "PlayList.h"
#include <cassert>
#include "Song.h"

void PlayListTester::runTests() {
	cout << "Testing class PlayList..." << endl;
	testConstructors();
	testSearchByArtist();
	testsearchByYear();
	testsearchByTitlePhrase();
	testAddandRemove();
	testSave();
	cout << "All tests passed!" << endl;

}

void PlayListTester::testConstructors() {
	cout << "- constructors..." << flush;
	PlayList pList("testSongs.txt");
	assert( pList.getNumSongs() == 4 );
	cout << " 0 " << flush;

	cout << " Passed!" << endl;
}

void PlayListTester::testSearchByArtist() {
	cout << "- searchByArtist()... " << flush;
	// load a playlist with test songs
	PlayList pList("testSongs.txt");

	// empty case (0 artists)
	vector<Song> searchResult = pList.searchByArtist("Cream");
	assert( searchResult.size() == 0 );
	cout << " 0 " << flush;

	// case of 1 artist
	searchResult = pList.searchByArtist("Baez");
	assert( searchResult.size() == 1 );
	assert( searchResult[0].getTitle() == "Let It Be" );
	cout << " 1 " << flush;

	// case of 2 artists
	searchResult = pList.searchByArtist("Beatles");
	assert( searchResult.size() == 2 );
	assert( searchResult[0].getTitle() == "Let It Be" );
	assert( searchResult[1].getTitle() == "Penny Lane" );
	cout << " 2 " << flush;

	cout << " Passed!" << endl;
}

void PlayListTester::testsearchByYear() {
	cout << "- searchByYear()... " << flush;
	// load a playlist with test songs
	PlayList pList("testSongs.txt");

	// empty case (0 artists)
	vector<Song> searchResult = pList.searchByYear (2019);
	assert( searchResult.size() == 0 );
	cout << " 0 " << flush;

	// case of 1 artist
	searchResult = pList.searchByYear(2012);
	assert( searchResult.size() == 1 );
	assert( searchResult[0].getTitle() == "Call Me Maybe" );
	cout << " 1 " << flush;

	// case of 2 artists
	searchResult = pList.searchByYear(1967);
	assert( searchResult.size() == 2 );
	assert( searchResult[0].getTitle() == "Let It Be" );
	assert( searchResult[1].getTitle() == "Penny Lane" );
	cout << " 2 " << flush;

	cout << " Passed!" << endl;
}

void PlayListTester:: testsearchByTitlePhrase() {
	cout << "- searchByTitlePhrase()... " << flush;
	// load a playlist with test songs
	PlayList pList("testSongs.txt");

	// empty case (0 artists)
	vector<Song> searchResult = pList.searchByTitlePhrase("Cream");
	assert( searchResult.size() == 0 );
	cout << " 0 " << flush;

	// case of 1 artist
	searchResult = pList.searchByTitlePhrase("Maybe");
	assert( searchResult.size() == 1 );
	assert( searchResult[0].getTitle() == "Call Me Maybe" );
	cout << " 1 " << flush;

	// case of 2 artists
	searchResult = pList.searchByTitlePhrase("Be");
	assert( searchResult.size() == 2 );
	assert( searchResult[0].getTitle() == "Let It Be" );
	assert( searchResult[1].getTitle() == "Let It Be" );
	cout << " 2 " << flush;

	cout << " Passed!" << endl;
}

void PlayListTester::testAddandRemove()
{
	cout << "- AddandRemove()..." << flush;
	// load a playlist with a fixed number of songs
	PlayList pList("testSongs.txt");
	assert( pList.getNumSongs() == 4);

	// Create a test song
	Song s1("High Fashion", "Roddy Rich", 2019);

	// Add and Check whether there is a new file
	pList.addSong(s1);
	assert( pList.getNumSongs() == 5);
	cout << " 0 " << flush;

	// 	Check whether the song file changes
	vector<Song> searchResult = pList.searchByTitlePhrase("High Fashion");
	assert( searchResult.size() == 1 );
	assert( searchResult[0].getTitle() == "High Fashion");
	assert( searchResult[0].getArtist() == "Roddy Rich");
	assert( searchResult[0].getYear() == 2019 );
	cout << " 1 " << flush;

	// Add another test Song
	Song s2("High Fashion", "Roddy Rich", 2019);
	pList.addSong(s2);
	assert( pList.getNumSongs() == 6);
	cout << " 2 " << flush;

	// Remove file and Check whether the song file changes
	pList.removeSong(s2);
	assert( pList.getNumSongs() == 5);
	cout << " 3 " << flush;

	cout << " Passed!" << endl;

}

void PlayListTester::testSave() {
	cout << "- save()..." << flush;

	// load a playlist with test songs
	PlayList pList("testSongs.txt");
	assert( pList.getNumSongs() == 4 );

	// create a test song and add it
	Song s1("War Baby", "Roddy Richh", 2019);
	pList.addSong(s1);

	// save it and make a new playlist
	pList.save();
	PlayList testpList("testSongs.txt");
	assert( pList.getNumSongs() == testpList.getNumSongs() );
	cout << " 0" << flush;
	// returning file to original state for future tests
	testpList.removeSong( s1 );
	testpList.save();
	assert( testpList.getNumSongs() == 4 );
	cout << " 1" << flush;

	cout << " Passed!" << endl;
}


